---
title: "Assignment 1"
author: "Emanuele Coradin"
date: "2024-04-09"
output: 
  read_document: rmdformats::readthedown
  html_document:
    number_sections: true
    theme: spacelab
  pdf_document:
    number_sections: true
    toc: true
    toc_depth: 2
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

color_vector <- c("#CC0000",   # Wine-like color
                  "#0072B2",   # Strong blue
                  "#CC79A7",   # Muted purple
                  "#D55E00",   # Vermilion
                  "#009E73",   # Bluish green
                  "#56B4E9",   # Sky blue
                  "#E69F00")   # Yellow-orange
```

## Exercise 1

The repository <https://drive.google.com/drive/folders/1NESuaJ5yGIrAli1TgrpnK5hnoxGsMi3h?usp=sharing> contains bike-sharing data provided by New York City, Citi Bike sharing system. The data (in csv format) is structured as follows:

- Trip duration (in seconds) 
- Start Time and date 
- Stop Time and date 
- Start Station ID, name, latitude and longitude 
- End Station ID, name, latitude and longitude 
- Bike ID 
- User Type (Customer or Subscriber ) 
- Birthâ€™s Year 
- Gender (0=unknown; 1=male; 2=female)

List of libraries:

Todo list: 

1. Read the data and import them in a data.frame or tibble structure
2. Merge the five data frames in a unique structure
3. Check for missing data and remove it

The files are stored inside the **Data_CitiBike*>** folder, the named **JC-20190x-citibike-tripdata.csv** with x in {2, 3, 4, 5, 6}  being the identifier of the file.

```{r, message=FALSE, echo=FALSE}
library(dplyr)
library(ggplot2)
```
```{r}
# ---------------- READING AND IMPORTING DATAFRAMES ----------------
PATH <- "./Data_CitiBike/"
indices <- 2:6
files <- unlist(lapply(indices, function(i) {
  sprintf("%sJC-20190%i-citibike-tripdata.csv", PATH, i)
}))

dataframes <- lapply(files, function(filename) {
  read.csv(filename, header = TRUE, sep = ",")
})

# Merging
df <- bind_rows(dataframes)

# Checking for missing data
#fill blanks with not a numbers
df[df==""]<-NA
#complete.cases() gives TRUE if the row contains all the fields
df<-df[complete.cases(df),]

head(df)

```

4. 
    4.1. Compute the average and the median trip duration in minutes 
    4.2. Evaluate the minimum and maximum trip duration; does that sound like a reasonable value? 
    4.3. Repeat the calculation of the average (and the median) trip duration by excluding trips longer than 3 hours. Next, evaluate the number of skimmed entries 
    4.4. Plot the distribution of trip duration after the skimming of the previous point

```{r }
writeLines(sprintf("Average trip duration:   %.1f min 
                  \nMedian trip duration:    %.1f min 
                  \nMaximum trip duration:   %.1f min 
                  \nMinimum trip duration:   %.1f min", 
               mean(df$tripduration)/60.,
               median(df$tripduration)/60.,
               max(df$tripduration)/60.,
               min(df$tripduration)/60.))
```

The .....

```{r }
skimmed_df = df[df$tripduration<(3.*3600), ]
writeLines(sprintf(
              "Average trip duration:   %.1f min
             \nMedian trip duration:    %.1f min
             \nMaximum trip duration:   %.1f min
             \nMinimum trip duration:   %.1f min
             \nNumber of rejected rows: %i", 
               mean(skimmed_df$tripduration)/60.,
               median(skimmed_df$tripduration)/60.,
               max(skimmed_df$tripduration)/60.,
               min(skimmed_df$tripduration)/60.,
               nrow(df) - nrow(skimmed_df)))

```
```{r }
#Plot the distributions
hist(skimmed_df$tripduration/60., col=color_vector[6], probability = TRUE, xlab = 'log(Trip Duration [min])', ylab = 'Probability Density [1/min]', main = 'Trip Duration Distribution') 

lines(density(skimmed_df$tripduration/60.), col = color_vector[1], lwd = 3)
```
```{r }
ggplot(data = skimmed_df)

```

